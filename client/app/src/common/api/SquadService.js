var SquadService = function($http, $log, $state, apiConfig, messageModel) {

  this.getSquads = function() {
    var apiUrl = apiConfig.baseURL + "admin/squads/all";

    var promise = $http.get(apiUrl)
      .success(function(data) {
        $log.debug("SquadService: getSquads success");
        return data;
      })
      .error(function(data) {
        $log.debug("SquadService: getSquads failed");
        return data;
      });

    return promise;
  };

  this.getWeekSquads = function(week) {
    var apiUrl = apiConfig.baseURL + "admin/weeks/" + week.id + "/squads";

    var promise = $http.get(apiUrl)
      .success(function(data) {
        $log.debug("SquadService: getWeekSquads success");
        return data;
      })
      .error(function(data) {
        $log.debug("SquadService: getWeekSquads failed");
        return data;
      });

    return promise;
  };

  this.createSquad = function(squadParams) {
    var promise = $http.post(apiConfig.baseURL + "admin/squads/",
      { squad: squadParams })
      .success(function(data) {
        $log.debug("SquadService: createSquad success");
        // todo: this relies on a monkey patch at the moment - https://github.com/angular-ui/ui-router/issues/582
        // but may be resolved with future releases of angular-ui-router
        $state.reload(); // reloads all the resolves for the view league page and reinstantiates the controller
        messageModel.setMessage(data.message, false);
        return data;
      })
      .error(function(data) {
        $log.debug("SquadService: createSquad failed");
        messageModel.setMessage(data.message, false);
        return data;
      });

    return promise;
  };


};

SquadService.$inject = ['$http', '$log', '$state', 'apiConfig', 'messageModel'];
module.exports = SquadService;