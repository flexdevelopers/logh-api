var PickMakeController = function(regularPicks, playoffPicks, currentGames, $modalInstance, $scope, $log) {

  var regularPicks = regularPicks;
  var playoffPicks = playoffPicks;
  var picks = _.union(regularPicks, playoffPicks);

  $scope.games = currentGames.data;

  $scope.makePick = function(game) {
    if ($scope.isValid(game)) {
      $modalInstance.close();
    } else {
      alert('invalid selection');
    }
  };

  $scope.cancel = function () {
    $modalInstance.dismiss('cancel');
  };

  $scope.hasGameStarted = function(game) {
    return game.started;
  };

  $scope.hasSquadBeenUsed = function(game, squad) {
    var squadHasBeenUsed = false;
    _.each(picks, function(pick) {
      if (pick.squad_id == squad.id && pick.week_type_id == game.week_type_id) {
        squadHasBeenUsed = true;
      }
    });
    return squadHasBeenUsed;
  };

  $scope.isValid = function(game, squad) {
    return !$scope.hasGameStarted(game) && !$scope.hasSquadBeenUsed(game, squad);
  };

  $scope.hasError = function(input) {
    return !input.$focused && input.$dirty && input.$invalid;
  };

  $scope.hasPropertyError = function(input, property) {
    return !input.$focused && input.$dirty && input.$error[property];
  };

  /**
   * Invoked on startup, like a constructor.
   */
  var init = function () {
    $log.debug("make pick controller");
  };
  init();
};

PickMakeController.$inject = ['regularPicks', 'playoffPicks', 'currentGames', '$modalInstance', '$scope', '$log'];
module.exports = PickMakeController;
